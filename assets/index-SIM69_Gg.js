import{r as o,f as T,L as j,E,u as f,a as H,b as y,P as g,j as r,C as A,c as R,d as F,F as M,s as P,D as w,e as k,g as D}from"./index-BXfNTbZk.js";const U=({targetRef:t,runOnObserverTargetAppear:s,options:e})=>{const n=c=>{c[0].isIntersecting&&s()},a=new IntersectionObserver(n,{...e,threshold:1});o.useEffect(()=>{if(t.current)return a.observe(t.current),()=>{t.current&&a.unobserve(t.current)}},[t,s])},V=({filtering:t,page:s})=>{const e=new URLSearchParams;return t.category!==""&&e.append("category",t.category),e.append("sort",t.sort),e.append("page",String(s)),s!==0&&e.append("size",j.toString()),e};async function Z(t){const s="?"+V({...t,page:t.page??0}).toString(),n=await(await T({url:E.products+s,method:"GET"})).json();return{products:n.content,isLast:n.last}}function B(t){const s=o.useContext(t);if(!s)throw new Error("modal context를 찾을 수 없습니다.");return s}const G=({refreshCartItemIds:t})=>{const s=f(H),e=f(y);return{addCartItem:async c=>{await s.fetch({productId:c}),await t()},deleteCarItem:async c=>{c&&(await e.fetch({cartItemId:c}),await t())},error:s.error||e.error}},$=({fetch:t})=>({getStackedProducts:async({products:e,filtering:n,isLastPage:a,page:c})=>{if(a||!e.length)return;const i=c?c+g.plus:g.second,d=await t({filtering:n,page:i});if(d!==void 0)return{isLast:d.isLast,newProducts:[...e,...d.products],newPage:i}}}),z=({fetch:t})=>({getFilteredProducts:async e=>{const n=await t({filtering:e});if(n!==void 0)return{isLast:n.isLast,newProducts:n.products,newPage:g.first}}}),W=({targetRef:t,runOnObserverTargetAppear:s,children:e})=>(U({targetRef:t,runOnObserverTargetAppear:s}),r.jsx("div",{children:e})),Y="data:image/svg+xml,%3csvg%20width='14'%20height='15'%20viewBox='0%200%2014%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.12531%206.00001H8.45865V4.00001H10.4586V2.66667H8.45865V0.666672H7.12531V2.66667H5.12532V4.00001H7.12531V6.00001ZM4.45865%2012C3.72532%2012%203.13198%2012.6%203.13198%2013.3333C3.13198%2014.0667%203.72532%2014.6667%204.45865%2014.6667C5.19198%2014.6667%205.79198%2014.0667%205.79198%2013.3333C5.79198%2012.6%205.19198%2012%204.45865%2012ZM11.1253%2012C10.392%2012%209.79865%2012.6%209.79865%2013.3333C9.79865%2014.0667%2010.392%2014.6667%2011.1253%2014.6667C11.8586%2014.6667%2012.4586%2014.0667%2012.4586%2013.3333C12.4586%2012.6%2011.8586%2012%2011.1253%2012ZM4.57198%209.83334L4.59198%209.75334L5.19198%208.66667H10.1586C10.6586%208.66667%2011.0986%208.39334%2011.3253%207.98001L13.8986%203.30667L12.7386%202.66667H12.732L11.9986%204.00001L10.1586%207.33334H5.47865L5.39198%207.15334L3.89865%204.00001L3.26532%202.66667L2.63865%201.33334H0.458649V2.66667H1.79198L4.19198%207.72667L3.29198%209.36001C3.18532%209.54667%203.12532%209.76667%203.12532%2010C3.12532%2010.7333%203.72532%2011.3333%204.45865%2011.3333H12.4586V10H4.73865C4.65198%2010%204.57198%209.92667%204.57198%209.83334Z'%20fill='white'/%3e%3c/svg%3e",q="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_7805_110)'%3e%3cpath%20d='M15.1533%2015.1533L1.84667%201.84666L1.33333%201.33333L0.846667%200.846664L0%201.69333L2.92667%204.62L4.4%207.72666L3.5%209.36C3.39333%209.54666%203.33333%209.76666%203.33333%2010C3.33333%2010.7333%203.93333%2011.3333%204.66667%2011.3333H9.64L10.56%2012.2533C10.2267%2012.4933%2010.0067%2012.8867%2010.0067%2013.3333C10.0067%2014.0667%2010.6%2014.6667%2011.3333%2014.6667C11.78%2014.6667%2012.1733%2014.4467%2012.4133%2014.1067L14.3067%2016L15.1533%2015.1533ZM4.94667%2010C4.85333%2010%204.78%209.92666%204.78%209.83333L4.8%209.75333L5.4%208.66666H6.97333L8.30667%2010H4.94667ZM10.3667%208.66666C10.8667%208.66666%2011.3067%208.39333%2011.5333%207.98L13.92%203.65333C13.9733%203.56%2014%203.44666%2014%203.33333C14%202.96666%2013.7%202.66666%2013.3333%202.66666H4.36L10.3667%208.66666ZM4.66667%2012C3.93333%2012%203.34%2012.6%203.34%2013.3333C3.34%2014.0667%203.93333%2014.6667%204.66667%2014.6667C5.4%2014.6667%206%2014.0667%206%2013.3333C6%2012.6%205.4%2012%204.66667%2012Z'%20fill='black'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_7805_110'%3e%3crect%20width='16'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",J="_button_11gf3_1",K="_add_11gf3_7",Q="_icon_11gf3_17",_={button:J,add:K,delete:"_delete_11gf3_12",icon:Q},X={add:{src:Y,alt:"상품 담기",text:"담기"},delete:{src:q,alt:"상품 빼기",text:"빼기"}};function tt({buttonType:t,onClick:s}){const{src:e,alt:n,text:a}=X[t],c=`cart-action-button ${_.button} ${_[t]}`;return r.jsxs("button",{onClick:s,className:c,children:[r.jsx("img",{src:e,alt:n}),r.jsx("span",{className:"button__text",children:a})]})}function et({product:t}){const{refreshCartItemIds:s,cartItemIds:e}=B(A),{addCartItem:n,deleteCarItem:a,error:c}=G({refreshCartItemIds:s}),i=e==null?void 0:e.get(t.id),d=!!i,u=()=>d?a(i):n(t.id);return r.jsxs("li",{className:"product-card",children:[r.jsx("img",{src:t.imageUrl,alt:"",className:"product-card__image"}),r.jsxs("div",{className:"product-card__contents",children:[r.jsx("p",{className:"product-name",children:t.name}),r.jsxs("p",{className:"text",children:[t.price.toLocaleString(),"원"]}),r.jsx(tt,{buttonType:d?"delete":"add",onClick:u}),r.jsx(R,{error:c})]})]})}function st({products:t,children:s,loading:e}){const n=o.useRef(null),a=()=>{var c;t.length<=M&&((c=n.current)==null||c.scrollTo({top:0}))};return o.useEffect(()=>{a()},[n,t]),r.jsxs("section",{ref:n,className:"product-list-wrapper",children:[r.jsxs("ul",{className:"product-list",children:[t.map(c=>r.jsx(et,{product:c},c.id)),s]}),e&&r.jsx(F,{productsLength:j})]})}function nt(){const[t,s]=o.useState([]),[e,n]=o.useState(g.first),[a,c]=o.useState(!1),[i,d]=o.useState({category:"",sort:"price,asc"}),u=o.useRef(null),{fetch:p,loading:v,error:L}=f(Z),{getStackedProducts:S}=$({fetch:p}),{getFilteredProducts:b}=z({fetch:p}),m=({isLast:l,newProducts:h,newPage:C})=>{c(l),s(h),n(C)},I=o.useCallback(async()=>{const l=await S({page:e,isLastPage:a,products:t,filtering:i});l&&m(l)},[e,t,a,i]),O=async()=>{const l=await b(i);l&&m(l)},x=l=>{const{name:h,value:C}=l.target;d(N=>({...N,[h]:C}))};return o.useEffect(()=>{O()},[i]),o.useEffect(()=>{if(L)throw new Error("예기치 못한 에러 발생")},[L]),r.jsxs("div",{children:[r.jsx("h1",{className:"page__title",children:"bpple 상품 목록"}),r.jsxs("div",{className:P.dropdownGroup,children:[r.jsx(w,{label:"카테고리",name:"category",options:k,onChange:x}),r.jsx(w,{label:"가격순",name:"sort",options:D,onChange:x})]}),r.jsx(st,{products:t,loading:v,children:r.jsx(W,{targetRef:u,runOnObserverTargetAppear:I,children:r.jsx("div",{className:P.observerTarget,ref:u,children:r.jsx("span",{children:"observer target"})})})})]})}export{nt as default};
